<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <link rel="stylesheet" type="text/css" href="./res/static/css/main.css">
  <link rel="stylesheet" type="text/css" href="./res/layui/css/layui.css">
  <script type="text/javascript" src="./res/layui/layui.js"></script>
  <!-- 引入bootstrap的js -->
  <script src="/js/bootstrap/js/jquery-3.3.1.min.js"></script>
  <script src="/js/bootstrap/js/bootstrap.min.js"></script>
  <link href="/js/bootstrap/css/bootstrap.min.css" rel="stylesheet"></link>
  <!-- 引入bootbox的js -->
  <script src="/js/bootstrap-bootbox/bootbox.locales.min.js"></script>
  <script src="/js/bootstrap-bootbox/bootbox.min.js"></script>
  <!-- 引入DataTables的js -->
  <link href="/js/bootstrap-DataTables/css/jquery.dataTables.css" rel="stylesheet">
  <script src="/js/bootstrap-DataTables/js/jquery.dataTables.js" charset="utf8"></script>
  <!-- 引入datetimepicker的js -->
  <link href="/js/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
  <script src="/js/bootstrap-datetimepicker/js/moment-with-locales.js" charset="utf8"></script>
  <script src="/js/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js" charset="utf8"></script>
  <!-- 引入fileinput的js -->
  <link href="/js/bootstrap-fileinput/css/fileinput.min.css" rel="stylesheet">
  <script src="/js/bootstrap-fileinput/js/fileinput.min.js" charset="utf8"></script>
  <script src="/js/bootstrap-fileinput/js/locales/zh.js" charset="utf8"></script>

  <!--引入fileInput-->
  <link href="/js/bootstrap-fileinput-v5.0.6-17/css/fileinput.css" rel="stylesheet" type="text/css">
  <script src="/js/bootstrap-fileinput-v5.0.6-17/js/fileinput.js"></script>
  <!-- 引入bootstrapvalidator的js -->
  <link href="/js/bootstrap-validator/css/bootstrapValidator.min.css" rel="stylesheet">
  <script src="/js/bootstrap-validator/js/bootstrapValidator.min.js" charset="utf8"></script>
  <!-- 引入bootstrap-select的js -->
  <link href="/js/bootstrap-select/css/bootstrap-select.min.css" rel="stylesheet">
  <script src="/js/bootstrap-select/js/bootstrap-select.min.js" charset="utf8"></script>
  <script src="/js/bootstrap-select/js/i18n/defaults-zh_CN.min.js" charset="utf8"></script>

  <!-- 引入日期的js -->
  <script src="/js/date-format.js" charset="utf8"></script>








  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
</head>
<body>

  <div class="site-nav-bg">
    <div class="site-nav w1200">
      <p class="sn-back-home">
        <i class="layui-icon layui-icon-home"></i>
        <a href="#">首页</a>
      </p>
      <div class="sn-quick-menu">
        <div class="login"><a href="login.html">登录</a></div>
        <div class="sp-cart"><a href="shopcart.html">购物车</a><span></span></div>
        <div class="sp-cart"><a href="myOrder.html">我的订单</a></div>
      </div>
    </div>
  </div>



  <div class="header">
    <div class="headerLayout w1200">
      <div class="headerCon">
        <h1 class="mallLogo">
          <a href="#" title="母婴商城">
            <img src="./res/static/img/logo.png">
          </a>
        </h1>
        <div class="mallSearch">
          <form action="" class="layui-form" novalidate>
            <input type="text" name="title" required  lay-verify="required" autocomplete="off" class="layui-input" placeholder="请输入需要的商品">
            <button class="layui-btn" lay-submit lay-filter="formDemo">
                <i class="layui-icon layui-icon-search"></i>
            </button>
            <input type="hidden" name="" value="">
          </form>
        </div>
      </div>
    </div>
  </div>


  <div class="content content-nav-base  login-content">
    <div class="main-nav">
      <div class="inner-cont0">
        <div class="inner-cont1 w1200">
          <div class="inner-cont2">
            <a href="commodity.html" class="active">所有商品</a>
            <a href="buytoday.html">今日团购</a>
            <a href="information.html">母婴资讯</a>
            <a href="about.html">关于我们</a>
          </div>
        </div>
      </div>
    </div>
    <div class="login-bg">
      <div class="login-cont w1200">
        <div class="form-box">
          <form class="layui-form" action="">
            <legend>手机号登录</legend>
            <div class="layui-form-item">
              <div class="layui-inline iphone">
                <div class="layui-input-inline">
                  <i class="layui-icon layui-icon-cellphone iphone-icon"></i>
                  <input type="tel" name="phone" id="phone" lay-verify="required|phone" placeholder="请输入手机号" autocomplete="off" class="layui-input">
                </div>
              </div>
              <div class="layui-inline veri-code">
                <div class="layui-input-inline">
                  <input id="pnum" type="text" name="pnum" lay-verify="required" placeholder="请输入验证码" autocomplete="off" class="layui-input">
                  <input type="button" onclick="sendMsg()" class="layui-btn" id="find"  value="验证码" />
                </div>
              </div>
            </div>
            <div class="layui-form-item login-btn">
              <div class="layui-input-block">
                <type type="button" class="layui-btn" lay-submit="" lay-filter="demo1" onclick="login()">登录</type>
                <type type="button" class="layui-btn" lay-submit="" lay-filter="demo1" onclick="addArea()">注册</type>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">
    <div class="ng-promise-box">
      <div class="ng-promise w1200">
        <p class="text">
          <a class="icon1" href="javascript:;">7天无理由退换货</a>
          <a class="icon2" href="javascript:;">满99元全场免邮</a>
          <a class="icon3" style="margin-right: 0" href="javascript:;">100%品质保证</a>
        </p>
      </div>
    </div>
    <div class="mod_help w1200">                                     
      <p>
        <a href="javascript:;">关于我们</a>
        <span>|</span>
        <a href="javascript:;">帮助中心</a>
        <span>|</span>
        <a href="javascript:;">售后服务</a>
        <span>|</span>
        <a href="javascript:;">母婴资讯</a>
        <span>|</span>
        <a href="javascript:;">关于货源</a>
      </p>
      <p class="coty">母婴商城版权所有 &copy; 2012-2020</p>
    </div>
  </div>



  <!-- 注册页面 -->
  <div id="addDiv" style="display: none">
    <form class="form-horizontal" role="form" method="post" id="addForm" enctype="multipart/form-data">
      <div class="form-group">
        <label class="col-sm-2 control-label">用户名称</label>
        <div class="col-sm-6">
          <input type="text" class="form-control" id="vipNameAdd" name="vipNameAdd">
        </div>
      </div>

      <div class="form-group">
        <label class="col-sm-2 control-label">手机号</label>
        <div class="col-sm-6">
          <input type="text" class="form-control" id="numAdd" name="numAdd">
        </div>
      </div>



      <div class="form-group">
        <label  class="col-sm-2 control-label">地区</label>
        <div class="col-sm-10">
          <select id="province" onchange="showCity()">

          </select>
          <select id="city" onchange="showCountry()">
            <option>请选择</option>
          </select>
          <select id="country">
            <option>请选择</option>
          </select>
        </div>
      </div>


      <div class="form-group">
        <label class="col-sm-2 control-label">图片</label>
        <div class="col-sm-6">
          <input id="imgpath" class="form-control" type="text"/>
          <input type="file" id="images" name="picture" multiple class="form-control"/>
        </div>
      </div>

      <div class="form-group">
        <div class="col-sm-offset-2 col-sm-10">
          <button type="button" class="btn btn-info" onclick="addVip()"><span class="glyphicon glyphicon-plus"></span>注册</button>
        </div>
      </div>
    </form>
  </div>




  <script type="text/javascript">


       //验证码验证
      var countdown=60*5;
      function settime(obj) {
          if (countdown == 0) {
              obj.removeAttribute("disabled");
              obj.classList.remove("layui-btn-disabled")
              obj.value="获取验证码";
              countdown = 60*5;
              return;
          } else {
              obj.value="重新发送(" + countdown + ")";
              countdown--;
          }
          setTimeout(function() {
                  settime(obj) }
              ,1000)
      }


      //发送短信
      function sendMsg() {
          var iphone=$("#phone").val();
          if(/^1\d{10}$/.test(iphone)){
              $.post({
                  url:"http://localhost:8080/vip/sendMessage",
                  dataType:"json",
                  data:{"iphone":iphone},
                  success:function (rs) {
                      if(rs.code==200){
                          $("#find").addClass(" layui-btn-disabled");
                          $('#find').attr('disabled',"true");
                          settime($("#find")[0]);
                          $("#msg").text(rs.data);
                      }else{
                          layer.msg(data.msg);
                      }
                  },error:function () {
                      alert("发送验证码失败");
                  }
              });
          }
      }

      //登录
      function login() {
          //获取手机号
          var iphone=$("#phone").val();
          //获取验证码
          var code=$("#pnum").val();
          $.post({
              url:"http://localhost:8080/VipController/login",
              data:{"iphone":iphone,"code":code},
              dataType:"json",
              success:function (rs) {
                  if(rs.data.status==200){
                      var token=rs.data.token;
                      //秘钥要保存到浏览器中  localstory  sessionstory  区别就是存值的存活范围
                      sessionStorage.setItem("login_token",token);
                      sessionStorage.setItem("iphone",iphone);
                      alert("登录成功");
                      location.href="index.html";
                  }else{
                      alert(rs.data.message);
                  }
              },error:function(){
                  alert("登录异常");
              }
          });
      }
      
      

    
  </script>



  <script>



      //========================================新增
      var areaData;
      var vipBox;
      var validateObj;
      function addArea() {
          //获取新增的HTML
          var htmls = $("#addDiv").html();
          vipBox = bootbox.dialog({
              title: "新增商品",
              message: htmls
          })

          validateObj = $("#addForm", vipBox).bootstrapValidator({
              feedbackIcons: {//相关提示图表
                  valid: 'glyphicon glyphicon-ok',//验证通过
                  invalid: 'glyphicon glyphicon-remove',//验证失败
                  validating: 'glyphicon glyphicon-refresh'//验证时
              }, fields: { //对那些字段  进行校验
                  vipNameAdd: {
                      validators: {//验证要求
                          notEmpty: {
                              message: "vip名不能为空"
                          }, regexp: {
                              regexp: /^([a-zA-Z]){2,20}$/,
                              message: 'vip名必须为英文，长度2-20'
                          }, remote: {//远程校验  返回的数据格式 {valid:true}
                              url: "http://localhost:8083/AreaController/checkName",
                              message: '用户名已存在',
                              delay: 1000,
                              type: 'POST',
                              data: function (validator) {//传递的参数
                                  return {
                                      vipName: $("#vipNameAdd", vipBox).val(),
                                  }
                              }
                          }
                      }
                  }
              }
          });
          //加载地区
          $.post({
              url: "http://localhost:8083/AreaController/queryList2",
              dataType: "json",
              success: function (rs) {
                  if (rs.code == 200) {
                      areaData = rs.data;
                      var provinceHtml = "<option value='-1'>请选择</option>";
                      for (var i = 0; i < areaData.length; i++) {
                          if (areaData[i].pid == 1) {
                              provinceHtml += '<option value="' + areaData[i].areaId + '">' + areaData[i].areaName + '</option>'
                          }
                      }
                      //将拼接的内容  填充到下拉框中
                      $("#province", vipBox).html(provinceHtml);
                      initFileInput("#addForm #images");
                  } else {
                      alert(rs.message);
                  }
              },
              error: function () {
                  alert("获取地区失败！");
              }
          });
      }



      //二级
      function showCity() {
          //处理当一级改动的时候三级内容不变的情况（清除三级内容）
          $("#country",vipBox).html("<option value='-1'>请选择</option>");

          var cityHtml="<option value='-1'>请选择</option>";
          for (var i = 0; i < areaData.length; i++) {
              var id=$("#province",vipBox).val();
              if(areaData[i].pid==id){
                  cityHtml+='<option value="'+areaData[i].areaId+'">'+areaData[i].areaName+'</option>'
              }
          }
          $("#city",vipBox).html(cityHtml);
      }



      //三级
      function showCountry() {
          var countryHtml="<option value='-1'>请选择</option>";
          for (var i = 0; i < areaData.length; i++) {
              var id=$("#city",vipBox).val();
              if(areaData[i].pid==id){
                  countryHtml+="<option value='"+areaData[i].areaId+"'>"+areaData[i].areaName+"</option>"
              }
          }
          $("#country",vipBox).html(countryHtml);
      }



      // 新增
      function addVip() {
          //得到校验的结果
          var rs=validateObj.data("bootstrapValidator").isValid();//校验合格
          if(rs==true){
              var param = {};
              param.vipName = $("#vipNameAdd",vipBox).val();
              param.num = $("#numAdd",vipBox).val();
              param.imgpath = $("#addForm #imgpath",vipBox).val();

              //处理地区
              var province = $("#province",vipBox).val();
              var city = $("#city",vipBox).val();
              var country = $("#country",vipBox).val();
              param.areaId=province+","+city+","+country;


              $.post({
                  url:"http://localhost:8083/AreaController/addVip",
                  data:param,
                  dataType:"json",
                  success:function (rs) {
                      if (rs.code==200){
                          alert("新增成功");
                          vipBox.modal("hide");
                      }
                  },
                  error:function () {
                      alert("新增网络异常！");
                  }
              })
          }else{
              //主动进行form表单检查
              validateObj.data("bootstrapValidator").validate();//校验效果
          }
      }





      //===================================================图片上传
      function initFileInput(id){
          $(id).fileinput({
              language:"zh",
              previewFileType:"image",//设置需要预览的文件类型
              uploadClass:"btn btn-danger", // 设置上传按钮的样式
              allowedFileTypes:["image","text","html"], // 设置支持上传的类型
              allowedFileExtensions:["jpg","gif","txt","pdf"], // 设置上传的后缀
              maxFileSize:1024*20, // 设置预览文件大小
              maxFileCount:5, // 设置上传的最大个数
              //设置上传文件的地址
              uploadUrl:"http://localhost:8083/AreaController/OSSFileUpload",
              // 上传图片需要传的值
              uploadExtraData:function(){
              }
          })

          // 上传图片的回调函数
          $(id).on("fileuploaded",function(event,data){ // data代表后台返回的值
              // 获取上传完图片后返回的值
              var map = data.response;
              // 判断图片上成功
              // 将上传收的图片名放到Input框中，这个Input框的name要跟实体类保持一致，这样后台就能接到新的文件名了
              $("#addForm #imgpath").val($("#addForm #imgpath").val()+map.filePath);
          })
      }






  </script>

</body>
</html>